# SEC API to Database Mapping

This document details the mapping between the SEC EDGAR API (XBRL Facts) and the `sec_financial_reports` database table as implemented in `import_all_sec_data.py`.

## Data Sources
- **Ticker Mapping**: `https://www.sec.gov/files/company_tickers.json`
- **Company Facts**: `https://data.sec.gov/api/xbrl/companyfacts/CIK{CIK}.json`
- **Current Price**: Yahoo Finance (via `yfinance`)

## Unit Handling Logic
The ETL script iterates through a company's facts and supports the following units:
- **`USD`**: Standard monetary values (Revenue, Net Income, etc.).
- **`USD/shares`**: Specific to **EPS** (Earnings Per Share).
- **`shares`**: Specific to **Shares Outstanding**.

This ensures that critical non-monetary metrics are accurately captured during the import process.

## Mapping Table

| Database Column                       | SEC XBRL Tag(s) / API Field                                                                                                                                                                                                 | Logic / Notes                                                                              |
| :------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------- |
| **cik**                               | `cik_str`                                                                                                                                                                                                                   | Padded to 10 digits.                                                                       |
| **fiscal_year**                       | `fy`                                                                                                                                                                                                                        | Extracted from year-end (FY) items.                                                        |
| **filing_date**                       | `filed`                                                                                                                                                                                                                     |                                                                                            |
| **form**                              | `form`                                                                                                                                                                                                                      | e.g., 10-K.                                                                                |
| **price**                             | `regularMarketPrice` / `currentPrice`                                                                                                                                                                                       | Fetched via `yfinance`.                                                                    |
| **revenue**                           | `RevenueFromContractWithCustomerExcludingAssessedTax`, `Revenues`, `SalesRevenueNet`, `SalesRevenueGoodsNet`, `SalesRevenueServicesNet`                                                                                     | First matching tag used.                                                                   |
| **cost_of_revenue**                   | `CostOfGoodsAndServicesSold`, `CostOfRevenue`, `CostOfGoodsSold`, `CostOfServices`                                                                                                                                          |                                                                                            |
| **gross_profit**                      | `GrossProfit`, Calculated                                                                                                                                                                                                   | Tag `GrossProfit` OR (`revenue` - `cost_of_revenue`)                                       |
| **research_and_development**          | `ResearchAndDevelopmentExpense`                                                                                                                                                                                             |                                                                                            |
| **selling_general_and_admin**         | `SellingGeneralAndAdministrativeExpense`                                                                                                                                                                                    |                                                                                            |
| **operating_expenses**                | `OperatingExpenses`                                                                                                                                                                                                         |                                                                                            |
| **operating_income**                  | `OperatingIncomeLoss`, `IncomeFromOperations`                                                                                                                                                                               |                                                                                            |
| **interest_expense**                  | `InterestExpense`                                                                                                                                                                                                           |                                                                                            |
| **interest_and_investment_income**    | `InvestmentIncomeInterest`                                                                                                                                                                                                  |                                                                                            |
| **pretax_income**                     | `IncomeLossFromContinuingOperationsBeforeIncomeTaxExtraordinaryItemsNoncontrollingInterest`, `IncomeLossBeforeIncomeTaxes`                                                                                                  |                                                                                            |
| **income_tax_expense**                | `IncomeTaxExpenseBenefit`                                                                                                                                                                                                   |                                                                                            |
| **net_income**                        | `NetIncomeLoss`, `ProfitLoss`, `NetIncomeLossAvailableToCommonStockholdersBasic`                                                                                                                                            |                                                                                            |
| **shares_outstanding**                | `CommonStockSharesOutstanding`, `WeightedAverageNumberOfDilutedSharesOutstanding`, `WeightedAverageNumberOfSharesOutstandingDiluted`, `WeightedAverageNumberOfSharesOutstandingBasic`, `EntityCommonStockSharesOutstanding` |                                                                                            |
| **eps**                               | `EarningsPerShareDiluted`, `EarningsPerShareBasic`                                                                                                                                                                          |                                                                                            |
| **dividend_per_share**                | `CommonStockDividendsPerShareDeclared`, Calculated                                                                                                                                                                          | Calc: `PaymentsOfDividends` / `shares_outstanding`                                         |
| **PaymentsOfDividends**               | `PaymentsOfDividendsCommonStock`                                                                                                                                                                                            |                                                                                            |
| **gross_margin**                      | Calculated                                                                                                                                                                                                                  | `gross_profit` / `revenue`                                                                 |
| **operating_margin**                  | Calculated                                                                                                                                                                                                                  | `operating_income` / `revenue`                                                             |
| **profit_margin**                     | Calculated                                                                                                                                                                                                                  | `net_income` / `revenue`                                                                   |
| **cash_and_equivalents**              | `CashAndCashEquivalentsAtCarryingValue`, `Cash`                                                                                                                                                                             |                                                                                            |
| **short_term_investments**            | `MarketableSecuritiesCurrent`, `ShortTermInvestments`                                                                                                                                                                       |                                                                                            |
| **cash_and_short_term_investments**   | Calculated                                                                                                                                                                                                                  | `cash_and_equivalents` + `short_term_investments`                                          |
| **receivables**                       | `AccountsReceivableNetCurrent`                                                                                                                                                                                              |                                                                                            |
| **inventory**                         | `InventoryNet`                                                                                                                                                                                                              |                                                                                            |
| **total_current_assets**              | `AssetsCurrent`                                                                                                                                                                                                             |                                                                                            |
| **property_plant_and_equipment**      | `PropertyPlantAndEquipmentNet`                                                                                                                                                                                              |                                                                                            |
| **long_term_investments**             | `MarketableSecuritiesNoncurrent`                                                                                                                                                                                            |                                                                                            |
| **goodwill**                          | `Goodwill`                                                                                                                                                                                                                  |                                                                                            |
| **other_intangible_assets**           | `IntangibleAssetsNetExcludingGoodwill`                                                                                                                                                                                      |                                                                                            |
| **total_assets**                      | `Assets`                                                                                                                                                                                                                    |                                                                                            |
| **accounts_payable**                  | `AccountsPayableCurrent`                                                                                                                                                                                                    |                                                                                            |
| **accrued_expenses**                  | `AccruedLiabilitiesCurrent`                                                                                                                                                                                                 |                                                                                            |
| **current_portion_of_long_term_debt** | `LongTermDebtAndCapitalLeaseObligationsCurrent`, `LongTermDebtCurrent`, `ShortTermBorrowings`                                                                                                                               |                                                                                            |
| **short_term_borrowings**             | `ShortTermBorrowings`                                                                                                                                                                                                       | New column for distinct short-term debt.                                                   |
| **total_current_liabilities**         | `LiabilitiesCurrent`, `Liabilities`                                                                                                                                                                                         |                                                                                            |
| **long_term_debt**                    | `LongTermDebtNoncurrent`, `LongTermDebt`                                                                                                                                                                                    |                                                                                            |
| **total_liabilities**                 | `Liabilities`, Calculated                                                                                                                                                                                                   | Calc: `total_current_liabilities` + `long_term_debt`                                       |
| **shareholders_equity**               | `StockholdersEquity`                                                                                                                                                                                                        |                                                                                            |
| **retained_earnings**                 | `RetainedEarningsAccumulatedDeficit`                                                                                                                                                                                        | New column for equity analysis.                                                            |
| **treasury_stock**                    | `TreasuryStockValue`                                                                                                                                                                                                        | New column (contra-equity).                                                                |
| **additional_paid_in_capital**        | `AdditionalPaidInCapital`                                                                                                                                                                                                   | New column for equity analysis.                                                            |
| **total_liabilities_and_equity**      | Calculated                                                                                                                                                                                                                  | `total_liabilities` + `shareholders_equity`                                                |
| **depreciation_and_amortization**     | `Depreciation`, `DepreciationDepletionAndAmortization`, `DepreciationAndAmortization`, `DepreciationDepletionAndAmortizationExpense`                                                                                        |                                                                                            |
| **stock_based_compensation**          | `ShareBasedCompensation`                                                                                                                                                                                                    |                                                                                            |
| **operating_cash_flow**               | `NetCashProvidedByUsedInOperatingActivities`                                                                                                                                                                                |                                                                                            |
| **capital_expenditures**              | `PaymentsToAcquirePropertyPlantAndEquipment`, `CapitalExpenditures`                                                                                                                                                         |                                                                                            |
| **investing_cash_flow**               | `NetCashProvidedByUsedInInvestingActivities`                                                                                                                                                                                |                                                                                            |
| **financing_cash_flow**               | `NetCashProvidedByUsedInFinancingActivities`                                                                                                                                                                                |                                                                                            |
| **net_cash_flow**                     | `NetIncreaseDecreaseInCashAndCashEquivalents`                                                                                                                                                                               |                                                                                            |
| **free_cash_flow**                    | Calculated                                                                                                                                                                                                                  | `operating_cash_flow` - abs(`capital_expenditures`)                                        |
| **working_capital**                   | Calculated                                                                                                                                                                                                                  | `total_current_assets` - `total_current_liabilities`                                       |
| **book_value_per_share**              | Calculated                                                                                                                                                                                                                  | `shareholders_equity` / `shares_outstanding`                                               |
| **Dividend_Payout_Ratio**             | Calculated                                                                                                                                                                                                                  | `PaymentsOfDividends` / `net_income`                                                       |
| **EBITDA**                            | Calculated                                                                                                                                                                                                                  | `operating_income` + `depreciation_and_amortization`                                       |
| **ev** (Enterprise Value)             | Calculated                                                                                                                                                                                                                  | (`price` * `shares_outstanding`) + `total_liabilities` - `cash_and_short_term_investments` |
| **public_float**                      | `EntityPublicFloat`                                                                                                                                                                                                         | New column.                                                                                |
| **entity_shares_outstanding**         | `EntityCommonStockSharesOutstanding`                                                                                                                                                                                        | New column (from Cover Page).                                                              |
| **filer_category**                    | `EntityFilerCategory`                                                                                                                                                                                                       | New column.                                                                                |
| **auditor_attestation_flag**          | `IcfrAuditorAttestationFlag`                                                                                                                                                                                                | New boolean column.                                                                        |
| **shell_company_flag**                | `EntityShellCompany`                                                                                                                                                                                                        | New boolean column.                                                                        |
| **created_at**                        | Handled by Database                                                                                                                                                                                                         | Defaults to `current_timestamp()`.                                                         |
| **updated_at**                        | Handled by Database                                                                                                                                                                                                         | Updates on record change.                                                                  |
